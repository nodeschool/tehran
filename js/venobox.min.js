/* 
 * VenoBox - jQuery Plugin
 * version: 1.3.3
 * @requires jQuery
 *
 * Examples at http://lab.veno.it/venobox/
 * License: Creative Commons Attribution 3.0 License
 * License URI: http://creativecommons.org/licenses/by/3.0/
 * Copyright 2013-2014 Nicola Franchini - @nicolafranchini
 *
 */
(function(e){function B(){e.ajax({url:f,cache:false}).done(function(e){u.html('<div class="vbox-inline">'+e+"</div>");U(true)}).fail(function(){u.html('<div class="vbox-inline"><p>Error retrieving contents, please retry</div>');U(true)})}function j(){u.html('<iframe class="venoframe" src="'+f+'"></iframe>');U()}function F(){var e=f.split("/");var t=e[e.length-1];u.html('<iframe class="venoframe" src="http://player.vimeo.com/video/'+t+'"></iframe>');U()}function I(){var e=f.split("/");var t=e[e.length-1];u.html('<iframe class="venoframe" src="http://www.youtube.com/embed/'+t+'"></iframe>');U()}function q(){u.html('<div class="vbox-inline">'+e(f).html()+"</div>");U()}function R(){d=e(".vbox-content").find("img");d.one("load",function(){U()}).each(function(){if(this.complete)e(this).load()})}function U(t){t=t||false;if(t!=true){e(window).scrollTop(0)}L.html(T);u.find(">:first-child").addClass("figlio");e(".figlio").css("width",v).css("height",m).css("padding",g).css("background",y);c=u.outerHeight();h=e(window).height();if(c+80<h){p=(h-c)/2;u.css("margin-top",p);u.css("margin-bottom",p)}else{u.css("margin-top","40px");u.css("margin-bottom","40px")}u.animate({opacity:"1"},"slow")}function z(){if(e(".vbox-content").length){c=u.height();h=e(window).height();if(c+80<h){p=(h-c)/2;u.css("margin-top",p);u.css("margin-bottom",p)}else{u.css("margin-top","40px");u.css("margin-bottom","40px")}}}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H;e.fn.extend({venobox:function(c){var h={framewidth:"",frameheight:"",border:"0",bgcolor:"#fff",numeratio:false,infinigall:false};var c=e.extend(h,c);return this.each(function(){var h=e(this);h.addClass("vbox-item");h.data("framewidth",c.framewidth);h.data("frameheight",c.frameheight);h.data("border",c.border);h.data("bgcolor",c.bgcolor);h.data("numeratio",c.numeratio);h.data("infinigall",c.infinigall);t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?true:false;n=document.all&&!window.atob?true:false;h.click(function(c){function p(){w=h.data("gall");O=h.data("numeratio");H=h.data("infinigall");E=e('.vbox-item[data-gall="'+w+'"]');if(E.length>0&&O===true){A.html(E.index(h)+1+" / "+E.length);A.fadeIn()}else{A.fadeOut()}S=E.eq(E.index(h)+1);x=E.eq(E.index(h)-1);if(h.attr("title")){T=h.attr("title");L.fadeIn()}else{T="";L.fadeOut()}if(H===true){N=true;C=true;if(S.length<1){S=E.eq(0)}if(E.index(h)<1){x=E.eq(E.index(E.length))}}else{if(S.length>0){e(".vbox-next").css("display","block");N=true}else{e(".vbox-next").css("display","none");N=false}if(E.index(h)>0){e(".vbox-prev").css("display","block");C=true}else{e(".vbox-prev").css("display","none");C=false}}}c.stopPropagation();c.preventDefault();h=e(this);r=h.data("overlay");v=h.data("framewidth");m=h.data("frameheight");g=h.data("border");y=h.data("bgcolor");N=false;C=false;k=false;f=h.attr("href");l=e(window).scrollTop();l=-l;e("body").wrapInner('<div class="vwrap"></div>');s=e(".vwrap");a='<div class="vbox-overlay" style="background:'+r+'"><div class="vbox-preloader">Loading...</div><div class="vbox-container"><div class="vbox-content"></div></div><div class="vbox-title"></div><div class="vbox-num">0/0</div><div class="vbox-close">X</div><div class="vbox-next">next</div><div class="vbox-prev">prev</div></div>';e("body").append(a);i=e(".vbox-overlay");o=e(".vbox-container");u=e(".vbox-content");A=e(".vbox-num");L=e(".vbox-title");u.html("");u.css("opacity","0");p();i.css("min-height",e(window).outerHeight()+130);if(n){i.animate({opacity:1},250,function(){i.css({"min-height":e(window).outerHeight(),height:"auto"});if(h.data("type")=="iframe"){j()}else if(h.data("type")=="inline"){q()}else if(h.data("type")=="ajax"){B()}else if(h.data("type")=="vimeo"){F()}else if(h.data("type")=="youtube"){I()}else{u.html('<img src="'+f+'">');R()}})}else{i.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){i.css({"min-height":e(window).outerHeight(),height:"auto"});if(h.data("type")=="iframe"){j()}else if(h.data("type")=="inline"){q()}else if(h.data("type")=="ajax"){B()}else if(h.data("type")=="vimeo"){F()}else if(h.data("type")=="youtube"){I()}else{u.html('<img src="'+f+'">');R()}});i.css("opacity","1")}if(t){s.css({position:"fixed",top:l,opacity:"0"}).data("top",l)}else{s.css({position:"fixed",top:l}).data("top",l);e(window).scrollTop(0)}e("body").keydown(function(t){if(k)return;if(t.keyCode==37&&C==true){k=true;r=x.data("overlay");v=x.data("framewidth");m=x.data("frameheight");g=x.data("border");y=x.data("bgcolor");f=x.attr("href");if(x.attr("title")){T=x.attr("title")}else{T=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight()+130);u.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(x.data("type")=="iframe"){j()}else if(x.data("type")=="inline"){q()}else if(x.data("type")=="ajax"){B()}else if(x.data("type")=="youtube"){I()}else if(x.data("type")=="vimeo"){F()}else{u.html('<img src="'+f+'">');R()}h=x;p();k=false})}if(t.keyCode==39&&N==true){k=true;r=S.data("overlay");v=S.data("framewidth");m=S.data("frameheight");g=S.data("border");y=S.data("bgcolor");f=S.attr("href");if(S.attr("title")){T=S.attr("title")}else{T=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight()+130);u.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(S.data("type")=="iframe"){j()}else if(S.data("type")=="inline"){q()}else if(S.data("type")=="ajax"){B()}else if(S.data("type")=="youtube"){I()}else if(S.data("type")=="vimeo"){F()}else{u.html('<img src="'+f+'">');R()}h=S;p();k=false})}});e(".vbox-next").click(function(){r=S.data("overlay");v=S.data("framewidth");m=S.data("frameheight");g=S.data("border");y=S.data("bgcolor");f=S.attr("href");if(S.attr("title")){T=S.attr("title")}else{T=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight()+130);u.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(S.data("type")=="iframe"){j()}else if(S.data("type")=="inline"){q()}else if(S.data("type")=="ajax"){B()}else if(S.data("type")=="youtube"){I()}else if(S.data("type")=="vimeo"){F()}else{u.html('<img src="'+f+'">');R()}h=S;p()})});e(".vbox-prev").click(function(){r=x.data("overlay");v=x.data("framewidth");m=x.data("frameheight");g=x.data("border");y=x.data("bgcolor");f=x.attr("href");if(x.attr("title")){T=x.attr("title")}else{T=""}if(r===undefined){r=""}i.css("min-height",e(window).outerHeight()+130);u.animate({opacity:0},500,function(){i.css("min-height",e(window).outerHeight()).css("background",r);if(x.data("type")=="iframe"){j()}else if(x.data("type")=="inline"){q()}else if(x.data("type")=="ajax"){B()}else if(x.data("type")=="youtube"){I()}else if(x.data("type")=="vimeo"){F()}else{u.html('<img src="'+f+'">');R()}h=x;p()})});e(".vbox-close, .vbox-overlay").click(function(r){D=".figlio";_=".vbox-prev";M=".vbox-next";P=".figlio *";if(!e(r.target).is(D)&&!e(r.target).is(M)&&!e(r.target).is(_)&&!e(r.target).is(P)){if(n){i.animate({opacity:0},500,function(){i.remove();e(".vwrap").children().unwrap();e(window).scrollTop(-l);k=false})}else{i.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");i.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){i.remove();if(t){e(".vwrap").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){e(".vwrap").children().unwrap();e(window).scrollTop(-l)});e(".vwrap").css("opacity","1")}else{e(".vwrap").children().unwrap();e(window).scrollTop(-l)}k=false});i.css("opacity","0")}}});return false})})}});e(window).resize(function(){z()})})(jQuery)